!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@fr0st/ui"),require("@fr0st/query")):"function"==typeof define&&define.amd?define(["exports","@fr0st/ui","@fr0st/query"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).UI=t.UI||{},t.UI,t.fQuery)}(this,(function(t,e,i){"use strict";class s extends e.BaseComponent{constructor(t,s){super(t,s),i.hasAttribute(this._node,"step")&&(this._options.step=i.getAttribute(this._node,"step")),i.hasAttribute(this._node,"min")&&(this._options.min=i.getAttribute(this._node,"min")),i.hasAttribute(this._node,"max")&&(this._options.max=i.getAttribute(this._node,"max")),null===this._options.max&&(this._options.max=this._options.stars),i.getProperty(this._node,"readOnly")&&(this._options.displayOnly=!0),this._options.step&&(this._stepLength=`${this._options.step}`.replace("d*.?/","").length);const n=i.getAttribute(this._node,"id");this._label=i.findOne(`label[for="${n}"]`),this._label&&!i.getAttribute(this._label,"id")&&(i.setAttribute(this._label,{id:e.generateId("starrating-label")}),this._labelId=!0),this._render(),this._refresh(),this._options.displayOnly||this._events(),this._options.tooltip&&this._tooltipEvents(),this._refreshDisabled()}disable(){i.setAttribute(this._node,{disabled:!0}),this._refreshDisabled()}dispose(){this._labelId&&i.removeAttribute(this._label,"id"),this._tooltip&&(this._tooltip.dispose(),this._tooltip=null),i.remove(this._outerContainer),i.removeAttribute(this._node,"tabindex"),i.removeEvent(this._node,"focus.ui.starrating"),i.removeClass(this._node,this.constructor.classes.hide),this._label=null,this._outerContainer=null,this._container=null,this._filledContainer=null,super.dispose()}enable(){i.removeAttribute(this._node,"disabled"),this._refreshDisabled()}getValue(){const t=i.getValue(this._node);return""!==t?parseFloat(t):null}setValue(t){if(t=parseFloat(t),(t=this._clampValue(t))===this.getValue())return;const e=this._getPercent(t);i.setStyle(this._filledContainer,{width:`${e}%`}),this._updateValue(t),i.setValue(this._node,t),i.triggerEvent(this._node,"change.ui.starrating")}}s.defaults={size:"md",min:0,max:null,step:1,stars:5,ratingText(t){return 1===t?`${t} ${this.constructor.lang.star}`:`${t} ${this.constructor.lang.stars}`},tooltip:!0,hover:!0,animate:!0,displayOnly:!1},s.classes={animate:"starrating-animate",container:"starrating",disabled:"starrating-disabled",filled:"starrating-filled",hide:"visually-hidden",outline:"starrating-outline"},s.icons={filled:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.62L12 2L9.19 8.62L2 9.24l5.45 4.73L5.82 21L12 17.27z" fill="currentColor"/></svg>',outline:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M12 15.39l-3.76 2.27l.99-4.28l-3.32-2.88l4.38-.37L12 6.09l1.71 4.04l4.38.37l-3.32 2.88l.99 4.28M22 9.24l-7.19-.61L12 2L9.19 8.63L2 9.24l5.45 4.73L5.82 21L12 17.27L18.18 21l-1.64-7.03L22 9.24z" fill="currentColor"/></svg>'},s.lang={star:"star",stars:"stars"};const n=s.prototype;n._clampValue=function(t){return this._options.step&&(t=(t/=this._options.step)<1?Math.round(t):Math.ceil(t),t=(t*=this._options.step).toFixed(this._stepLength)),i._clamp(t,this._options.min,this._options.max)},n._events=function(){i.addEvent(this._node,"focus.ui.starrating",(t=>{i.focus(this._container)}));const t=i.mouseDragFactory((t=>{if(t.button||i.is(this._node,":disabled"))return!1;i.setStyle(this._filledContainer,{transition:"none"});const s=e.getPosition(t),n=i.percentX(this._container,s.x,{offset:!0}),o=this._getValue(n);this.setValue(o),i.setDataset(this._container,{uiDragging:!0}),this._options.tooltip&&!i.getDataset(this._container,"uiHover")&&(this._tooltip._stop(),this._tooltip.show())}),(t=>{const s=e.getPosition(t),n=i.percentX(this._container,s.x,{offset:!0}),o=this._getValue(n);this.setValue(o)}),(t=>{i.removeDataset(this._container,"uiDragging"),this._options.tooltip&&!i.getDataset(this._container,"uiHover")&&(this._tooltip._stop(),this._tooltip.hide());const s=e.getPosition(t),n=i.percentX(this._container,s.x,{offset:!0}),o=this._getValue(n);o===this.getValue()?this._updateValue(o):this.setValue(o),i.rect(this._filledContainer),i.setStyle(this._filledContainer,{transition:""})}));i.addEvent(this._container,"mousedown.ui.starrating touchstart.ui.starrating",t),i.addEvent(this._container,"keydown.ui.starrating",(t=>{let e=this.getValue();switch(null===e&&(e=this._options.min),t.code){case"ArrowLeft":case"ArrowDown":e-=this._options.step;break;case"ArrowRight":case"ArrowUp":e+=this._options.step;break;case"End":e=this._options.max;break;case"Home":e=this._options.min;break;case"PageDown":e--;break;case"PageUp":e++;break;default:return}this.setValue(e)})),this._options.hover&&this._hoverEvents()},n._getPercent=function(t){return 100*i._inverseLerp(0,this._options.stars,t)},n._getValue=function(t){const e=i._lerp(0,this._options.stars,t/100);return this._clampValue(e)},n._hoverEvents=function(){i.addEvent(this._container,"mousemove.ui.starrating",i.debounce((t=>{if(i.is(this._node,":disabled")||i.getDataset(this._container,"uiDragging"))return;const e=i.percentX(this._container,t.pageX,{offset:!0}),s=this._getValue(e),n=this._getPercent(s);i.setStyle(this._filledContainer,{transition:"none"}),i.setStyle(this._filledContainer,{width:`${n}%`}),i.rect(this._filledContainer),i.setStyle(this._filledContainer,{transition:""}),this._updateValue(s,{updateAria:!1})})),{passive:!0}),i.addEvent(this._container,"mouseleave.ui.starrating",(t=>{i.is(this._node,":disabled")||i.getDataset(this._container,"uiDragging")||this._refresh()}))},n._refresh=function(){const t=this.getValue(),e=this._getPercent(t);i.setStyle(this._filledContainer,{width:`${e}%`}),this._updateValue(t)},n._refreshDisabled=function(){const t=i.is(this._node,":disabled");t?i.addClass(this._container,this.constructor.classes.disabled):i.removeClass(this._container,this.constructor.classes.disabled),i.setAttribute(this._container,{"aria-disabled":t,tabindex:t?-1:0})},n._render=function(){this._outerContainer=i.create("div"),this._options.animate&&i.addClass(this._outerContainer,this.constructor.classes.animate);const t=this.getValue()||0;this._container=i.create("div",{class:[this.constructor.classes.container,`starrating-${this._options.size}`],attributes:{role:"slider","aria-valuenow":t,"aria-valuetext":this._options.ratingText.bind(this)(t),"aria-valuemin":this._options.min,"aria-valuemax":this._options.max,"aria-required":i.getProperty(this._node,"required"),"aria-labelledby":i.getAttribute(this._label,"id")}});const s=[],n=[];for(let t=0;t<this._options.stars;t++)s.push(this.constructor.icons.outline),n.push(this.constructor.icons.filled);const o=i.create("div",{class:this.constructor.classes.outline,html:s.join("")});this._filledContainer=i.create("div",{class:this.constructor.classes.filled,html:n.join("")}),i.append(this._container,o),i.append(this._container,this._filledContainer),i.append(this._outerContainer,this._container),i.addClass(this._node,this.constructor.classes.hide),i.setAttribute(this._node,{tabindex:-1}),i.before(this._node,this._outerContainer),this._options.tooltip&&(this._tooltip=e.Tooltip.init(this._container,{appendTo:"body",trigger:"",placement:"top"}))},n._tooltipEvents=function(){i.addEvent(this._container,"mouseenter.ui.starrating",(t=>{i.isSame(t.target,this._container)&&(i.getDataset(this._container,"uiDragging")||(this._tooltip._stop(),this._tooltip.show()),i.setDataset(this._container,{uiHover:!0}))})),i.addEvent(this._container,"mouseleave.ui.starrating",(t=>{i.isSame(t.target,this._container)&&(i.getDataset(this._container,"uiDragging")||(this._tooltip._stop(),this._tooltip.hide()),i.removeDataset(this._container,"uiHover"))}))},n._updateValue=function(t,{updateAria:e=!0,updateTooltip:s=!0}={}){null===t&&(t=this._options.min);const n=this._options.ratingText.bind(this)(t);e&&i.setAttribute(this._container,{"aria-valuenow":t,"aria-valuetext":n}),s&&this._tooltip&&(i.setDataset(this._container,{uiTitle:n}),this._tooltip.refresh(),this._tooltip.update())},e.initComponent("starrating",s),t.StarRating=s}));